<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factoring Quadratics MVP</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f8;
            color: #333;
        }
        header {
            background-color: #0057b7;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        header button {
            background-color: #ff6600;
            border: none;
            color: white;
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 4px;
        }
        header button:hover {
            background-color: #e65c00;
        }
        #bookBtn {
            background-color: #28a745;
        }
        #bookBtn:hover {
            background-color: #218838;
        }
        main {
            display: flex;
            padding: 20px;
            gap: 20px;
        }
        #lessonContent {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #practiceArea {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        #practiceArea input[type="text"] {
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        #practiceArea button {
            background-color: #0057b7;
            color: white;
            border: none;
            padding: 10px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 4px;
        }
        #practiceArea button:hover {
            background-color: #004494;
        }
        #feedback {
            font-weight: bold;
        }
        #tutorChat {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 300px;
            height: 400px;
            border: 1px solid #333;
            background: #f9f9f9;
            border-radius: 8px;
            overflow: hidden;
        }
        #tutorChat h3 {
            margin: 0;
            background-color: #0057b7;
            color: white;
            padding: 10px;
            border-radius: 8px 8px 0 0;
        }
        #chatMessages {
            height: 320px;
            overflow-y: auto;
            border: 1px solid #ccc;
            background: white;
            padding: 5px;
        }
        #chatInput {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 70%;
        }
        #sendChat {
            background-color: #ff6600;
            border: none;
            color: white;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            margin-left: 5px;
        }
        #sendChat:hover {
            background-color: #e65c00;
        }
        .placeholder {
            border: 2px dashed #ccc;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        #videoPlaceholder {
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1em;
            color: #666;
        }
        #bookPlaceholder {
            height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1em;
            color: #666;
        }
        #problemDisplay {
            min-height: 60px;
            margin-bottom: 15px;
            font-size: 1.2em;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #0057b7;
        }
        .difficulty-indicator {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Factoring Quadratics Learning Platform</h1>
        <div class="header-buttons">
            <button id="bookBtn">ðŸ“– Open Textbook</button>
            <button id="loginBtn">Login</button>
        </div>
    </header>
    <main>
        <section id="lessonContent">
            <h2>Lesson: Factoring Quadratics</h2>
            <div id="videoPlaceholder" class="placeholder">
                <p>ðŸ“¹ Video: Introduction to Factoring Quadratics</p>
            </div>
            <div id="bookPlaceholder" class="placeholder">
                <p>ðŸ“– Reading Material: See textbook section below</p>
            </div>
        </section>
        <section id="practiceArea">
            <h2>Practice Problems</h2>
            <div class="difficulty-indicator" id="difficultyLevel">Current Level: Easy</div>
            <div id="correctCountDisplay" style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Problems Solved: 0</div>
            <div id="problemDisplay"></div>
            <input type="text" id="answerInput" placeholder="Enter your answer here (e.g., (x+2)(x+3))">
            <button id="submitAnswer">Submit Answer</button>
            <div id="feedback" style="margin-top: 10px; height: 20px;"></div>
        </section>
    </main>

    <section id="bookSection" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin: 20px;">
        <h2>Reading Material: Quadratic Factoring Methods (Pages 50-51)</h2>
        <iframe src="https://drive.google.com/file/d/1BcJTLjQaelZ4w_70oHKyImC2I8zLfyrt/preview#page=50" 
                width="100%" height="400px" frameborder="0"></iframe>
    </section>

    <div id="tutorChat">
        <h3 id="chatHeader" style="cursor: pointer;">ðŸ’¬ Tutor Chat <span id="minimizeBtn">âˆ’</span></h3>
        <div id="chatContent">
            <div id="chatMessages"></div>
            <div style="padding: 10px;">
                <input type="text" id="chatInput" placeholder="Ask a question...">
                <button id="sendChat">Send</button>
            </div>
        </div>
    </div>

    <script>
        // Problem sets by difficulty
        const problems = {
            easy: [
                { question: "Factor: xÂ² + 5x + 6", answer: "(x+2)(x+3)" },
                { question: "Factor: xÂ² + 7x + 10", answer: "(x+2)(x+5)" },
                { question: "Factor: xÂ² - 3x - 10", answer: "(x-5)(x+2)" },
                { question: "Factor: xÂ² + 4x + 4", answer: "(x+2)Â²" },
                { question: "Factor: xÂ² - 9", answer: "(x-3)(x+3)" }
            ],
            medium: [
                { question: "Factor: 2xÂ² + 7x + 3", answer: "(2x+1)(x+3)" },
                { question: "Factor: 3xÂ² - 2x - 8", answer: "(3x+4)(x-2)" },
                { question: "Factor: -xÂ² + 5x - 6", answer: "-(x-2)(x-3)" },
                { question: "Factor: 4xÂ² + 12x + 9", answer: "(2x+3)Â²" },
                { question: "Factor: 6xÂ² - 5x - 6", answer: "(2x-3)(3x+2)" }
            ],
            hard: [
                { question: "A rectangle has an area of xÂ² + 5x + 6 square units. What are its possible dimensions?", answer: "(x+2)(x+3)" },
                { question: "Find two consecutive integers whose product is 12.", answer: "3 and 4" },
                { question: "Factor: 6xÂ² + 11x - 35", answer: "(2x-5)(3x+7)" },
                { question: "Factor: 12xÂ² - 17x + 6", answer: "(3x-2)(4x-3)" },
                { question: "A projectile's height is given by h = -16tÂ² + 32t + 48. Factor this expression.", answer: "-16(t-3)(t+1)" }
            ]
        };

        let currentDifficulty = 'easy';
        let currentProblemIndex = 0;
        let correctStreak = 0;
        let incorrectStreak = 0;

        // Function to get the current user's correct problem count
        function getCorrectCount() {
            const user = localStorage.getItem('loggedInUser');
            if (!user) return 0;
            const counts = JSON.parse(localStorage.getItem('correctCounts') || '{}');
            return counts[user] || 0;
        }

        // Function to increment the correct problem count for the current user
        function incrementCorrectCount() {
            const user = localStorage.getItem('loggedInUser');
            if (!user) return;
            const counts = JSON.parse(localStorage.getItem('correctCounts') || '{}');
            counts[user] = (counts[user] || 0) + 1;
            localStorage.setItem('correctCounts', JSON.stringify(counts));
            updateCorrectCountDisplay();
        }

        // Function to update the display of correct count
        function updateCorrectCountDisplay() {
            const countElement = document.getElementById('correctCountDisplay');
            if (countElement) {
                countElement.textContent = `Problems Solved: ${getCorrectCount()}`;
            }
        }

        function updateDifficultyDisplay() {
            const difficultyElement = document.getElementById('difficultyLevel');
            difficultyElement.textContent = `Current Level: ${currentDifficulty.charAt(0).toUpperCase() + currentDifficulty.slice(1)}`;
        }

        function displayProblem() {
            if (currentProblemIndex === 0) {
                currentProblemIndex = Math.floor(Math.random() * problems[currentDifficulty].length);
            }
            const problem = problems[currentDifficulty][currentProblemIndex];
            document.getElementById('problemDisplay').textContent = problem.question;
            document.getElementById('answerInput').value = '';
            document.getElementById('feedback').textContent = '';
            updateDifficultyDisplay();
        }

        function normalize(str) {
            return str.toLowerCase()
                     .replace(/\s+/g, '')
                     .replace(/[()]/g, '')
                     .replace(/\^2/g, 'Â²')
                     .replace(/\*\*/g, 'Â²');
        }

        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value.trim();
            const correctAnswer = problems[currentDifficulty][currentProblemIndex].answer;
            const feedback = document.getElementById('feedback');

            if (normalize(userAnswer) === normalize(correctAnswer)) {
                feedback.textContent = 'âœ… Correct! Great job!';
                feedback.style.color = 'green';
                correctStreak++;
                incorrectStreak = 0;
                incrementCorrectCount();

                // Adaptive difficulty increase
                if (correctStreak >= 2 && currentDifficulty === 'easy') {
                    currentDifficulty = 'medium';
                    currentProblemIndex = 0;
                    correctStreak = 0;
                } else if (correctStreak >= 3 && currentDifficulty === 'medium') {
                    currentDifficulty = 'hard';
                    currentProblemIndex = 0;
                    correctStreak = 0;
                } else {
                    currentProblemIndex = (currentProblemIndex + 1) % problems[currentDifficulty].length;
                }
            } else {
                feedback.textContent = `âŒ Not quite right. The correct answer is: ${correctAnswer}`;
                feedback.style.color = 'red';
                incorrectStreak++;
                correctStreak = 0;

                // Adaptive difficulty decrease
                if (incorrectStreak >= 2 && currentDifficulty === 'hard') {
                    currentDifficulty = 'medium';
                    currentProblemIndex = 0;
                    incorrectStreak = 0;
                } else if (incorrectStreak >= 2 && currentDifficulty === 'medium') {
                    currentDifficulty = 'easy';
                    currentProblemIndex = 0;
                    incorrectStreak = 0;
                } else {
                    currentProblemIndex = (currentProblemIndex + 1) % problems[currentDifficulty].length;
                }
            }

            setTimeout(() => {
                displayProblem();
            }, 2000);
        }

        // Check if user is logged in
function checkLogin() {
    const loggedInUser = localStorage.getItem('loggedInUser');
    if (loggedInUser) {
        document.getElementById('loginBtn').textContent = `Logout (${loggedInUser})`;
        updateCorrectCountDisplay();
    } else {
        document.getElementById('loginBtn').textContent = 'Login / Register';
        updateCorrectCountDisplay();
    }
}

        // Logout function
        function logout() {
            localStorage.removeItem('loggedInUser');
            alert('You have been logged out.');
            checkLogin();
        }

        // Tutor chat functionality
        function initializeTutorChat() {
            const chatMessages = document.getElementById('chatMessages');
            const chatInput = document.getElementById('chatInput');
            const sendChat = document.getElementById('sendChat');

            // Add minimize/maximize functionality
            const chatHeader = document.getElementById('chatHeader');
            const chatContent = document.getElementById('chatContent');
            const minimizeBtn = document.getElementById('minimizeBtn');
            let isMinimized = false;

            chatHeader.addEventListener('click', () => {
                if (isMinimized) {
                    chatContent.style.display = 'block';
                    minimizeBtn.textContent = 'âˆ’';
                    document.getElementById('tutorChat').style.height = '400px';
                    isMinimized = false;
                } else {
                    chatContent.style.display = 'none';
                    minimizeBtn.textContent = '+';
                    document.getElementById('tutorChat').style.height = '40px';
                    isMinimized = true;
                }
            });

            function addMessage(sender, message, align = 'left') {
                const msgDiv = document.createElement('div');
                msgDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
                msgDiv.style.margin = '5px';
                msgDiv.style.textAlign = align;
                msgDiv.style.padding = '5px';
                msgDiv.style.borderRadius = '4px';
                msgDiv.style.backgroundColor = sender === 'You' ? '#e3f2fd' : '#f5f5f5';
                chatMessages.appendChild(msgDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            sendChat.addEventListener('click', () => {
                const message = chatInput.value.trim();
                if (message) {
                    addMessage('You', message, 'right');
                    const userMessage = message.toLowerCase();
                    chatInput.value = '';

                    // Simulate AI tutor response
                    setTimeout(() => {
                        let response;
                        
                        // AI-like responses based on keywords
                        if (userMessage.includes('factor') || userMessage.includes('factoring')) {
                            response = "To factor a quadratic like axÂ² + bx + c, look for two numbers that multiply to give 'ac' and add to give 'b'. Then use those numbers to split the middle term and factor by grouping.";
                        } else if (userMessage.includes('quadratic')) {
                            response = "A quadratic expression has the form axÂ² + bx + c. The key to factoring is finding patterns like difference of squares (aÂ² - bÂ²) or perfect square trinomials (aÂ² + 2ab + bÂ²).";
                        } else if (userMessage.includes('help') || userMessage.includes('stuck')) {
                            response = "I'm here to help! Try breaking the problem into steps: 1) Identify the type of quadratic, 2) Look for common factors first, 3) Use appropriate factoring method. What specific part are you struggling with?";
                        } else if (userMessage.includes('method') || userMessage.includes('how')) {
                            response = "There are several factoring methods: 1) Factor out GCF first, 2) For axÂ² + bx + c where a=1, find two numbers that multiply to c and add to b, 3) For general case, use AC method or factoring by grouping.";
                        } else if (userMessage.includes('check') || userMessage.includes('verify')) {
                            response = "Great question! Always check your factoring by expanding: multiply your factors back together. If you get the original expression, your factoring is correct!";
                        } else {
                            // General helpful responses
                            const generalResponses = [
                                "That's an interesting question! Remember that factoring is essentially 'un-distributing' - finding what was multiplied together to get the quadratic.",
                                "Good thinking! When factoring, always look for patterns first: perfect squares, difference of squares, or common factors.",
                                "I can help with that! The key insight is that factoring and expanding are opposite operations. What specific aspect would you like me to explain?",
                                "Excellent question! Try working through the problem step by step. What's the first thing you notice about this quadratic expression?"
                            ];
                            response = generalResponses[Math.floor(Math.random() * generalResponses.length)];
                        }
                        
                        addMessage('AI Tutor', response);
                    }, 1000);
                }
            });

            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendChat.click();
                }
            });

            // Welcome message
            addMessage('AI Tutor', 'Hi! I\'m your AI math tutor. I can help you understand factoring quadratics, explain methods, and answer your questions. What would you like to know?');
        }

        // Event listeners
        document.getElementById('submitAnswer').addEventListener('click', checkAnswer);
        document.getElementById('answerInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        // Attach event listener to login button
const loginBtn = document.getElementById('loginBtn');
loginBtn.addEventListener('click', () => {
    if (localStorage.getItem('loggedInUser')) {
        logout();
    } else {
        window.location.href = 'login.html';
    }
});


        // Book button functionality
        document.getElementById('bookBtn').addEventListener('click', () => {
            window.open('https://drive.google.com/file/d/1BcJTLjQaelZ4w_70oHKyImC2I8zLfyrt/view', '_blank');
        });

        // Initialize the application
        displayProblem();
        initializeTutorChat();
        checkLogin();
    </script>
</body>
</html>
